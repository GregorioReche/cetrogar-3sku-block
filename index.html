<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cetrogar 3 SKU Block</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding:16px; }
    label { display:block; margin-top:8px; font-weight:600; }
    input { width:100%; padding:8px; margin-top:4px; box-sizing:border-box; }
    .hint { font-size:12px; opacity:.7; margin-top:12px; }
  </style>
</head>
<body>
  <h3>Cetrogar · 6 SKU</h3>

  <label>SKU 1</label>
  <input id="sku1" placeholder="Ej: 12345" />

  <label>SKU 2</label>
  <input id="sku2" placeholder="Ej: 67890" />

  <label>SKU 3</label>
  <input id="sku3" placeholder="Ej: ABCDE" />

  <label>SKU 4</label>
  <input id="sku4" placeholder="Ej: FGHIJ" />

  <label>SKU 5</label>
  <input id="sku5" placeholder="Ej: KLMNO" />

  <label>SKU 6</label>
  <input id="sku6" placeholder="Ej: PQRST" />

  <p class="hint">El bloque guarda estado y genera AMPscript para tu email.</p>

  <!-- Incluí el blocksdk local (descargado del repo) -->
  <script src="https://unpkg.com/blocksdk/blocksdk.js"></script>
  <script>
    const sdk = new window.sfdc.BlockSDK();

    // Prefill desde el estado del bloque
    sdk.getData((data = {}) => {
      console.log("DATA RECUPERADA:", data);
      const { sku1 = '', sku2 = '', sku3 = '' , sku4 = '',sku5 = '',sku6 = ''} = data;
      document.getElementById('sku1').value = sku1;
      document.getElementById('sku2').value = sku2;
      document.getElementById('sku3').value = sku3;
      document.getElementById('sku4').value = sku4;
      document.getElementById('sku5').value = sku5;
      document.getElementById('sku6').value = sku6;
      //updateContent();
    });

    // Actualiza estado + contenido al tipear
    ['sku1','sku2','sku3','sku4','sku5','sku6'].forEach(id => {
      document.getElementById(id).addEventListener('input', updateContent);
    });

    function esc(str) {
      // escapamos comillas para AMPscript
      return String(str || '').replace(/"/g, '\\"');
    }

    function updateContent() {
      const sku1 = document.getElementById('sku1').value.trim();
      const sku2 = document.getElementById('sku2').value.trim();
      const sku3 = document.getElementById('sku3').value.trim();
      const sku4 = document.getElementById('sku4').value.trim();
      const sku5 = document.getElementById('sku5').value.trim();
      const sku6 = document.getElementById('sku6').value.trim();

      const data = { sku1, sku2, sku3, sku4, sku5, sku6 };
      console.log("DATA GUARDADA:", data);

      sdk.setData(data, () => {
        // Snippet AMPscript que el bloque insertará en el email
        const ampscript = `
%%[
  VAR @sku1, @sku2, @sku3, @sku4, @sku5, @sku6
  SET @sku1 = "${esc(sku1)}"
  SET @sku2 = "${esc(sku2)}"
  SET @sku3 = "${esc(sku3)}"
  SET @sku4 = "${esc(sku4)}"
  SET @sku5 = "${esc(sku5)}"
  SET @sku6 = "${esc(sku6)}"

  SET @catalogDE = "Catalogo"

  SET @rows1 = LookupRows(@catalogDE, "ProductCode", @sku1)
  SET @rows2 = LookupRows(@catalogDE, "ProductCode", @sku2)
  SET @rows3 = LookupRows(@catalogDE, "ProductCode", @sku3)
  SET @rows4 = LookupRows(@catalogDE, "ProductCode", @sku4)
  SET @rows5 = LookupRows(@catalogDE, "ProductCode", @sku5)
  SET @rows6 = LookupRows(@catalogDE, "ProductCode", @sku6)

  SET @row1 = Row(@rows1, 1)
  SET @row2 = Row(@rows2, 1)
  SET @row3 = Row(@rows3, 1)
  SET @row4 = Row(@rows4, 1)
  SET @row5 = Row(@rows5, 1)
  SET @row6 = Row(@rows6, 1)

  SET @name1 = Field(@row1, "ProductName")
  SET @img1  = Field(@row1, "Imagen")
  SET @price1= Field(@row1, "RegularPrice")
  SET @sale1 = Field(@row1, "SalePrice")
  SET @url1  = Field(@row1, "ProductLink")

  SET @name2 = Field(@row2, "ProductName")
  SET @img2 = Field(@row2, "Imagen")
  SET @price2 = Field(@row2, "RegularPrice")
  SET @sale2 = Field(@row2, "SalePrice")
  SET @url2 = Field(@row2, "ProductLink")

  SET @name3 = Field(@row3, "ProductName")
  SET @img3 = Field(@row3, "Imagen")
  SET @price3 = Field(@row3, "RegularPrice")
  SET @sale3 = Field(@row3, "SalePrice")
  SET @url3 = Field(@row3, "ProductLink")

  SET @name4 = Field(@row4, "ProductName")
  SET @img4 = Field(@row4, "Imagen")
  SET @price4 = Field(@row4, "RegularPrice")
  SET @sale4 = Field(@row4, "SalePrice")
  SET @url4 = Field(@row4, "ProductLink")

  SET @name5 = Field(@row5, "ProductName")
  SET @img5 = Field(@row5, "Imagen")
  SET @price5 = Field(@row5, "RegularPrice")
  SET @sale5 = Field(@row5, "SalePrice")
  SET @url5 = Field(@row5, "ProductLink")

  SET @name6 = Field(@row6, "ProductName")
  SET @img6 = Field(@row6, "Imagen")
  SET @price6 = Field(@row6, "RegularPrice")
  SET @sale6 = Field(@row6, "SalePrice")
  SET @url6 = Field(@row6, "ProductLink")
]%%
`.trim();

        // Contenido “real” que se guarda en el asset
        sdk.setContent(ampscript);

        // SuperContent solo para el preview en el editor (no se publica)
        const preview = `
<div style="font:14px/1.4 system-ui; color:#555;">
  Seleccione aquí los SKUs de los productos.
</div>`;
        sdk.setSuperContent(preview);
      });
    }
  </script>
</body>
</html>
